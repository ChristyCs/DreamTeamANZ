<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>Calendar</title>
        <!--<script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>-->
        <script src="d3.js"></script>
    </head>
    <style>
    #calendar{
        width: 600px;
        height: 400px;
        border-collapse: collapse;
    }

    #calendar td{
        border: 1px solid black;
        text-align: right;
        vertical-align: top;
    }
    </style>
    <body style = "margin-top: 0px; margin-left: 0px">
        <script type="text/javascript">

            // Round,Date,Time,Home Team,Score,Away Team,Venue
            var dataFile2008 = readCSV("ANZChampionshipResults/2008-Table1.csv");
            var dataFile2009 = readCSV("ANZChampionshipResults/2009-Table1.csv");
            var dataFile2010 = readCSV("ANZChampionshipResults/2010-Table1.csv");
            var dataFile2011 = readCSV("ANZChampionshipResults/2011-Table1.csv");
            var dataFile2012 = readCSV("ANZChampionshipResults/2012-Table1.csv");
            var dataFile2013 = readCSV("ANZChampionshipResults/2013-Table1.csv");
            var selectedDate = "Friday 13th October 2010";


            function readCSV(fname){
                d3.csv(fname, function(d) {
                return readData(d);
            }, function(error, rows) {
                return rows;
                });
            }

            function readData(d){
                return {
                    round: +d.Round,
                    date: d.Date,
                    time: d.Time,
                    hometeam: d['Home Team'],
                    score: d.Score,
                    awayteam: d['Away Team'],
                    venue: d.Venue
                 };
            }


            var width = window.innerWidth;
            var height = window.innerHeight;


            var svg = d3.select("body")
                .append("svg")
                .attr("width",width)
                .attr("height",height);

            setupPage();

            function setupPage(){
                svg.append("rect")
                    .attr("x",0)
                    .attr("y",0)
                    .attr("width",width)
                    .attr("height", height*0.1)
                    .attr("fill",("rgb(238,201,0)"));

                svg.append("rect")
                    .attr("x",0)
                    .attr("y",height*0.1)
                    .attr("width",width)
                    .attr("height", height*0.05)
                    .attr("fill",("rgb(151,255,255)"));

            svg.append("image")
                .attr("preserveAspectRatio","none")
                .attr("xlink:href","images/greyscale.jpg")
                .attr("x",0)
                .attr("y",height*0.15)
                .attr("width",width)
                .attr("height",height)
                .style("opacity", 0.8);
            }

            var g = svg.append("g");

            g.append("rect")
                .attr("x",width*0.2)
                .attr("y",height*0.25)
                .attr("width", width/2)
                .attr("height", height-(height/3))
                .attr("fill", "white");

            drawCalendar("June", "2010",g);

            /*Takes care of drawing the calendar which takes the current year and month
                and the group which to append it to.
            */
            function drawCalendar(month, year, group){
                //Two variations of months depends whether there are 30 or 31 days
                var days = [1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,
                19,20,21,22,23,24,25,26,27,28,29,30];
                var daysLonger = [1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,
                19,20,21,22,23,24,25,26,27,28,29,30,31];

                //Title for the calendar
                var titleFontSize = 40;
                group.append("text")
                    .text(month+" "+year)
                    .attr("x", width * 0.45)
                    .attr("y", height * 0.28 + titleFontSize)
                    .attr("font-size", titleFontSize)
                    .attr("font-family", "georgia")
                    .attr("fill", "black")
                    .attr("font-weight", "bold")
                    .attr("text-anchor", "middle");                 

                var cellWidth = width/20;
                var cellX = width*0.27;
                var cellY = height*0.4;
                var padding = 3;

                //Creates all the calendar day titles
                var dayNameY = cellY - 10;
                createDayNames("Sunday", cellX, dayNameY,cellWidth ,0 ,group);
                createDayNames("Monday", cellX, dayNameY,cellWidth ,1 ,group);
                createDayNames("Tuesday", cellX, dayNameY,cellWidth ,2 ,group);
                createDayNames("Wednesday", cellX, dayNameY,cellWidth ,3 ,group);
                createDayNames("Thursday", cellX, dayNameY,cellWidth ,4 ,group);
                createDayNames("Friday", cellX, dayNameY,cellWidth ,5 ,group);
                createDayNames("Saturday", cellX, dayNameY,cellWidth ,6 ,group);

                var cells;
                //Checks whether for different month lengths
                if(month == "April" || month == "June"){
                    cells = d3.selectAll(days);
                }
                else{
                    cells = d3.selectAll(daysLonger);
                }
                cells.each(function(d,i){
                    group.append("rect")
                        .attr("x",cellX)
                        .attr("y",cellY)
                        .attr("width", cellWidth)
                        .attr("height", cellWidth)
                        .attr("fill", "white")
                        .attr("stroke", "black")
                        .attr("stroke-width", 1.5)
                        .on("mousedown", function(){
                            console.log("Day click: "+(i+1));
                        })
                        .on("mouseover", function(){
                            d3.select(this)
                                .transition()
                                .attr("fill", "grey");
                        })
                        .on("mouseout", function(){
                            d3.select(this)
                                .transition()
                                .attr("fill", "white");
                        });
                    //Numbers each day of the month
                    group.append("text")
                        .text(i+1)
                        .attr("x", cellX + padding)
                        .attr("y", cellY + 20)
                        .attr("font-size", 20)
                        .attr("font-family", "georgia")
                        .attr("fill", "black");

                    //Checks whether it is a new week so a new row is created
                    cellX = cellX + cellWidth;
                    var remainder = (i + 1) % 7;
                    if(remainder == 0 && i != 0){
                        cellY = cellY + cellWidth;
                        cellX = width * 0.27;
                    }
                });
            }

            //Creates the day names for the calendar Sunday - Saturday etc
            function createDayNames(name, x, y, cellWidth, dayNum, group){
                group.append("text")
                    .text(name)
                    .attr("x", x + (cellWidth/2) + (cellWidth * dayNum))
                    .attr("y", y)
                    .attr("font-size", 15)
                    .attr("font-family", "georgia")
                    .attr("fill", "black")
                    .attr("text-anchor", "middle");  
            }

            var buttWid = width * 0.1;
            var buttHgt = height * 0.1;
            var buttY = height *0.2;
            addButton(width - buttWid, height *0.2, buttWid, buttHgt, "rgb(255,255,192)", "Homepage");
            addButton(width - buttWid, buttY + (buttHgt*1.5), buttWid, buttHgt, "rgb(238,238,128)", "Teams");

            addButton(width - buttWid, buttY + (buttHgt*3), buttWid, buttHgt, "rgb(205,205,64)", "Standings");
            addButton(width - buttWid, buttY + (buttHgt*4.5), buttWid, buttHgt, "rgb(171,171,32)", "Venues");
            addButton(width - buttWid, buttY + (buttHgt*6), buttWid, buttHgt, "rgb(139,139,0)", "Calendar");


            function addButton(x, y, width, height, colour, buttName){

                svg.append("rect")
                    .attr("id", buttName)
                    .attr("x", x)
                    .attr("y", y)
                    .attr("width", width)
                    .attr("height", height)
                    .attr("fill", colour)
                    .on("mouseover", function(){
                        d3.select(this)
                            .transition()
                            //.attr("fill", "green")
                            .attr("width", buttWid * 1.3)
                            .attr("x", x - buttWid * 0.3)
                            .attr("y", y - (0.15 * (buttHgt * 1.4)))
                            .attr("height", buttHgt * 1.4)
                     })
                    .on("mouseout", function(d){
                         d3.select(this)
                            .transition()
                            //.style("fill", colour)
                            .attr("width", buttWid)
                            .attr("x", x)
                            .attr("height", height)
                            .attr("y", y)
                    })
                    .on("mousedown", function(){
                        window.open(buttName + ".html", "_self")
                    })
                    appendText(buttName, x + 5, y + (0.5*buttWid), 20);
            }

            /**
              appends text to the dialog box created in the svg
              given the text and the x and y vals in which the
              text will be placed
            */
            function appendText(text, xVal, yVal, fontsize){
              d3.select("svg")
                .append("text")
                .transition()
                  .attr("id", "button")
                  .text(text)
                  .attr("x", xVal)
                  .attr("y", yVal)
                  .attr("font-size", fontsize)
                  .attr("font-family", "georgia")
                  .attr("fill", "black")
                  .attr("font-weight","bold")
            }
        </script>
    </body>
</html>
